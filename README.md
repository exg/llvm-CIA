# Overview

llvm-CIA (Custom Instruction Automation) is an add-on for LLVM,
consisting of an LLVM Pass and a script, which can be used to dump the
basic blocks of a program as annotated graphs in DOT format. For more
information, refer to the paper

[Emanuele Giaquinta, Anadi Mishra, Laura Pozzi: Maximum Convex Subgraphs Under I/O Constraint for Automatic Identification of Custom Instructions](https://doi.org/10.1109/TCAD.2014.2387375)

# Installation

1. Install LLVM and Clang version 3.8 or later
2. Bootstrap llvm-CIA using the bootstrap.sh script. You can
   optionally provide the path to the installed LLVM cmake directory
   as an argument, in case it is not known to cmake.

# Usage

* Profile your program using Clang profiling via instrumentation:

  http://clang.llvm.org/docs/UsersManual.html#profiling-with-instrumentation

  Follow steps 1, 2 and 3 of the above guide. Once you have obtained
  the profile data, generate the llvm assembly of the source files by
  compiling them with the command

  `clang -S -emit-llvm -fprofile-instr-use=PROFILE`

  where PROFILE is the profile filename.

  See the Makefile in the test directory for an example.

* run the bb-printer.sh script with the llvm assembly files as arguments.

  The script generates one annotated gv file for each basic
  block in your program in the current directory.

# Testing

The test directory contains an example program, the HadamardSAD8x8
routine extracted from the H264 reference code. You can test
llvm-CIA with it as follows:

  cd test  
  make run

The run target generates gv graphs for all basic blocks in the
example.

# Output format

The graphs generated by llvm-CIA are in DOT format and are annotated
with the following additional attributes:

Name|Type|Used by
----|----|-------
forbidden|bool|Node
weight|double|Node
frequency|int|Graph

# AUTHORS

Anadi Mishra  
Emanuele Giaquinta
